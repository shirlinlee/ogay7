<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>首頁</title>

    <!-- php lib -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/js/bootstrap4/bootstrap.css">
    <base href="">
    <!-- <link rel="stylesheet" href="assets/css/all.css"> -->
    <link rel="stylesheet" href="assets/css/index.css">

    <script src="assets/js/jquery-3.4.1.min.js"></script>
    <script src="assets/js/bootstrap4/popper.min.js"></script>
    <script src="assets/js/vue/vue.js"></script>
    <script src="assets/js/vue/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/qs/6.5.1/qs.min.js"></script>
    <script src="assets/js/bootstrap4/bootstrap.min.js"></script>
    <script src="https://kit.fontawesome.com/0e1a09a8fc.js" crossorigin="anonymous"></script>
    <script src="assets/js/allfunc.js"></script>

    <!-- php lib -->
    <style>
        .loader_inner_wrapper {
            position: fixed;
            z-index: 99999;
            width: 100%;
            height: 100%;
            background: transparent;
        }

        .loader_inner_wrapper img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translateX(-50%) translateY(-50%);
        }
    </style>
</head>

<body>
    <div class="loader_inner_wrapper text-center d-none" id="st_loading">
        <img src="assets/images/loading.svg" alt="" width=30 height=30>
    </div>
    <div id="wrapper">
        <!-- 以下header開始 -->
        <header>
            <div class="container">
                <nav class="navbar navbar-expand navbar-light d-flex justify-content-between">
                    <a href="./" class="navbar-brand"><img class="img-fluid" src="assets/images/logo.png" alt=""></a>
                    <button class="navbar-toggler" type="button" data-toggle="collapse"
                        data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse pt-3 pb-3" id="navbarSupportedContent"
                        style="flex-grow: unset;">
                        <form class="form-inline d-none d-lg-inline-block" id="site_search">
                            <input class="form-control" type="search" placeholder="在找什麼嗎？" aria-label="Search"
                                id="form_search">
                            <button class="btn" type="submit" id="form_submit"><i class="fas fa-search"></i></button>
                        </form>
                        <div class="d-flex flex-row bd-highlight align-items-center" id="header_func">
                            <div class="p-2 pl-lg-4 bd-highlight">
                                <span class="d-none d-lg-inline-block">購物車 / </span><span class="text-warning"
                                    id="price_in_cart">$0</span>
                                <a href="cart"><i class="fas fa-shopping-cart d-none"></i></a>
                            </div>
                            <div class="p-2 bd-highlight">
                                <a href="favorite"><i class="fab fa-gratipay d-none"></i><span
                                        class="d-md-block">追蹤清單</span></a>

                            </div>
                            <div class="p-2 bd-highlight">
                                <a href="mc_order"><i class="fas fa-user-circle d-none"></i><span
                                        class="d-md-block">帳戶管理</span></a>

                            </div>
                        </div>
                    </div>
                </nav>
            </div>
        </header>
        <!-- header結束 -->



        <!-- 以下menu開始 -->
        <div id="menu">
            <div class="container" :style="{'max-width': menu_width+'px' }">
                <ul :style="{'width': menu_width+'px' }" class="main_menu">
                    <li class="d-inline-block" v-for="(item, index) in main_list"
                        @click="menuHandler('current_main_menu', index, item.category_id)"
                        :class="{'active':current_main_menu === index}">{{ item.category_name }}</li>
                </ul>
            </div>
            <div id="sub_menu" class="container" :class="{'show': current_main_menu!== null}" @mouseleave="mouseLeave">
                <ul v-for="(sub_item, idx) in filter_rest_list" class="d-inline-block">
                    <h4>{{ sub_item.category_sub_name }}</h4>
                    <li v-for="extra_item in sub_item.extra_list"><a href="#">{{ extra_item.category_extra_name}}</a>
                    </li>
                </ul>
            </div>
        </div>

        <link rel="stylesheet" href="assets/css/header.css">
        <script>
            var wrapper = new Vue({
                el: '#menu',
                data: {
                    main_list: null,
                    sub_list: null,
                    extra_list: null,
                    current_main_menu: null,
                    current_sub_menu: '', // category_id
                    current_extra_menu: '', // category_sub_id
                    menu_width: 1258, // default: 個別選單寬度80*17個
                },
                computed: {
                    filter_rest_list() {
                        if (this.sub_list) {
                            const filter_data = this.sub_list.filter(item => {
                                const inner_list = this.extra_list.filter(extra => {
                                    return extra.category_sub_id === item.category_sub_id;
                                })
                                if (item.category_id === this
                                    .current_sub_menu) { // 把對應extra_list塞入sub_list
                                    item['extra_list'] = inner_list;
                                }
                                return item.category_id === this.current_sub_menu;
                            })
                            return filter_data;
                        }
                    }
                },
                mounted() {
                    this.$nextTick(() => {
                        this.loadMenu(); // 撈選單資料
                    })
                },
                methods: {
                    loadMenu() {
                        const main = axios.get("assets/json/find_main_list.json");
                        const sub = axios.get("assets/json/find_sub_list.json");
                        const extra = axios.get("assets/json/find_extra_list.json");

                        axios.all([main, sub, extra]).then(axios.spread((...responses) => {
                            const {
                                data: main_list
                            } = responses[0];
                            const {
                                data: sub_list
                            } = responses[1];
                            const {
                                data: extra_list
                            } = responses[2];
                            this.main_list = main_list;
                            this.sub_list = sub_list;
                            this.extra_list = extra_list;
                            this.menu_width = this.main_list.length * 80;
                        })).catch(errors => {
                            console.error(errors);
                            // react on errors.
                        })

                    },
                    menuHandler(menuType, index, id) { // 選單切換
                        this[menuType] = index;
                        switch (menuType) {
                            case 'current_main_menu': {
                                this.current_sub_menu = id;
                            }
                            break;
                        case 'current_sub_menu': {
                            this.current_extra_menu = id;
                        }
                        break;

                        }
                    },
                    mouseLeave() {
                        console.log('leave');
                        this.current_main_menu = null;
                    },
                }
            });
        </script>
        <!-- menu結束 -->


        <!-- 以下content始 -->
        <div id="content">
            <div id="carouselIndexCaptions" class="carousel slide" data-ride="carousel" data-interval="4000">
                <div class="carousel-inner">
                    <div class="carousel-item" :class="{'active': idx == 0 , 'd-none' : carouselClose }"
                        :data-bb="slide.img_src_pc" v-for="(slide,idx) in indexData[0].datalist">
                        <div :style="{ 'background-color' : slide.bgcolor }">
                            <!-- <div class="container"> -->
                            <!-- pc -->
                            <a :href="slide.target_link" :target="slide.target" class="d-none d-md-block"
                                rel="noopener noreferrer">
                                <img :src="slide.img_src_pc" class="d-block w-100" :alt="slide.subject">
                            </a>
                            <!-- m -->
                            <a :href="slide.target_link" rel="noopener noreferrer" :target="slide.target"
                                class="d-xs-block d-md-none"><img :src="slide.img_src_m" class="d-block w-100"
                                    alt=""></a>
                            <!-- <a :href="slide.target_link" class="d-xs-block d-md-none"><img :src="slide.img_src" class="d-block w-100" :alt="slide.subject"></a> -->
                            <!-- </div> -->
                        </div>
                    </div>
                </div>
                <a class="carousel-control-prev" href="#carouselIndexCaptions" role="button" data-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="sr-only">Previous</span>
                </a>
                <a class="carousel-control-next" href="#carouselIndexCaptions" role="button" data-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="sr-only">Next</span>
                </a>
            </div>

            <div class="container tab_area" id="tab1">
                <div class="tab">
                    <ul :style="{'width': tab1_width+ 'px'}">
                        <li class="d-inline-block" v-for="(tab, idx) in indexData[1].datalist"
                            :class="{'active': idx === current_tab1 }" @click="tabHandler('current_tab1', idx)">
                            {{ tab.title }}</li>
                    </ul>

                </div>
                <div class="mb_scroll">
                    <div class="row content_list" v-for="(row, idx) in indexData[1].datalist"
                        :class="{'active': idx === current_tab1 }" :style="{width: listWidth(1, idx)}">
                        <div class="col-sm-6 col-md-4 col-lg-3" v-for="(list, index) in row.products_list">
                            <div class="img_wrapper">
                                <img src="assets/images/product_1.png" width="100%" alt="">
                                <span class="label">{{ row.title }}</span>
                            </div>
                            <div class="info">
                                <h6>
                                    {{ list.product_name }}
                                </h6>
                                <span class="f_orange">{{ list.product_ad_info }}</span>
                                <span class="f_grey suggest_price">原價
                                    <span>{{ list.product_suggest_price }}</span></span>
                                <font class="d-inline-block"
                                    :style="{'color': list['tag-color'], 'border-color': list['tag-color']}">
                                    {{ list['tag-text'] }}</font>
                                <h5 class="f_orange price">{{ list.product_selling_price }}</h5>
                            </div>
                        </div>

                    </div>
                </div>

                <span class="see_more">更多折扣商品</span>
            </div>






        </div>
        <script>
            var wrapper = new Vue({
                el: '#content',
                data: {
                    indexData: {},
                    tab_width: 137,
                    list_item_width: 146,
                    current_tab1: 0,
                    tab1_width: 550,
                    current_tab2: 0,
                    current_tab3: 0,


                },
                created() {
                    this.index();
                },
                mounted() {
                    var _this = this;
                    _this.loadAndPop();
                    // 上下頁照params改動
                    window.onpopstate = function () {
                        _this.loadAndPop();
                    };
                    // 固定分類選單

                },
                methods: {
                    index: function () {
                        var _this = this;
                        axios({
                            method: 'get',
                            url: 'assets/json/index.json',
                            responseType: 'json',
                        }).then(function (data) {
                            const {
                                data: index_data,
                                status
                            } = data;
                            if (status == 200) {
                                _this.indexData = index_data;
                                _this.tab1_width = _this.tab_width * index_data[1].datalist.length;



                            } else {}
                        })
                    },
                    tabHandler: function (tab, index) {
                        this[tab] = index;
                    },
                    listWidth: function (tabIndex, listIndex) {
                        const getTab = this[`current_tab${tabIndex+1}`];
                        // console.log(getTab, listIndex);
                        console.log(this.indexData[tabIndex].datalist[getTab]
                            .products_list.length)
                        // this.indexData[index]
                        return '100%';
                    },
                    loadAndPop: function () {
                        var _this = this;
                        var _isUrlClear = allFunc.getUrlParam("category_id");
                        // _this.slide();
                        _this.index();

                        function afterMainLoad() {
                            // if( _isUrlClear == "" || _isUrlClear == null){
                            // 網址不帶params。隨機
                            // var _length = _this.category.main.length-1;
                            // var _getRandom = allFunc.randomFunc(0,_length);
                            // _this.category.active = {
                            //     main : _this.category.main[_getRandom].category_id,
                            //     sub : null,
                            //     extra : null,
                            // }
                            // window.history.pushState({},0,'category/' + '?category_id=' + _this.category.active.main);
                            // }else{
                            // _this.category.active = {
                            //     main : allFunc.getUrlParam("category_id"),
                            //     sub : allFunc.getUrlParam("category_sub_id"),
                            //     extra : allFunc.getUrlParam("category_extra_id"),
                            // }
                            // }
                            // 如果sub在：呼叫sub跟extra
                            // 如果sub不在：呼叫sub
                            // console.log(_this.category.active["sub"])
                            // if( _this.category.active["sub"] == undefined || _this.category.active["sub"] == null ){
                            //     // 如果sub不在
                            //     _this.list_sub(_this.category.active["main"]);
                            // }else{
                            //     // 如果sub在
                            //     _this.list_sub(_this.category.active["main"]);
                            //     _this.list_extra(_this.category.active["sub"]);
                            // }
                            // 呼叫商品列表
                            // _this.product_list()
                        }
                    },
                }
            });
        </script>
        <!-- content結束 -->




        <!-- footer php include -->
        <div id="footer">
            <div class="container mt-5 pt-5 clearfix">
                <div class="index-for5 mb-5">
                    <h2 class="mb-3">關於我們</h2>
                    <ul>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">7YAGO福利網</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">招募供應商</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">機構團體加入</a></li>
                    </ul>
                </div>
                <div class="index-for5 mb-5">
                    <h2 class="mb-3">專屬服務</h2>
                    <ul>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">大宗採購方案</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">年節禮品採購</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">異業合作</a></li>
                    </ul>
                </div>
                <div class="index-for5 mb-5">
                    <h2 class="mb-3">會員權益</h2>
                    <ul>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">隱私權政策</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">電子商務條款</a></li>
                    </ul>
                </div>
                <div class="index-for5 mb-5">
                    <h2 class="mb-3">常見問題</h2>
                    <ul>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">訂單出貨流程說明</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">取消訂單/退貨/退款說明</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">購物金使用說明</a></li>
                        <li><a href="http://" target="_blank" rel="noopener noreferrer">聯絡我們</a></li>
                    </ul>
                </div>
                <div class="index-for5 mb-5">
                    <h2 class="mb-3">隨身好助理</h2>
                    <img src="assets/images/qrcode.png" alt="" class="img-fluid w-75">
                </div>
            </div>
            <div class="text-center pb-3">
                <p class="m-0"><small>吉品養生股份有限公司 2020 ALL Rights Reserved</small></p>
                <p><small class="m-0">台北市忠孝東路四段212號10樓。客服信箱：service@yonglinfarm.net</small></p>
            </div>
        </div>


    </div>


    </div>
</body>

</html>