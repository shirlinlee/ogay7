<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>首頁</title>

    <!-- php lib -->
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@100;300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="assets/js/bootstrap4/bootstrap.css" />
    <base href="" />
    <!-- <link rel="stylesheet" href="assets/css/all.css"> -->
    <link rel="stylesheet" href="assets/css/index.css" />

    <script src="assets/js/jquery-3.4.1.min.js"></script>
    <script src="assets/js/bootstrap4/popper.min.js"></script>
    <script src="assets/js/vue/vue.js"></script>
    <script src="assets/js/vue/axios.min.js"></script>
    <script src="https://cdn.bootcss.com/qs/6.5.1/qs.min.js"></script>
    <script src="assets/js/bootstrap4/bootstrap.min.js"></script>
    <script
      src="https://kit.fontawesome.com/0e1a09a8fc.js"
      crossorigin="anonymous"
    ></script>
    <script src="assets/js/allfunc.js"></script>

    <!-- php lib -->
    <style>
      .loader_inner_wrapper {
        position: fixed;
        z-index: 99999;
        width: 100%;
        height: 100%;
        background: transparent;
      }

      .loader_inner_wrapper img {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translateX(-50%) translateY(-50%);
      }
    </style>
  </head>

  <body>
    <div class="loader_inner_wrapper text-center d-none" id="st_loading">
      <img src="assets/images/loading.svg" alt="" width="30" height="30" />
    </div>
    <div id="wrapper">
      <!-- 以下header開始 -->
      <header>
        <div class="container">
          <nav
            class="navbar navbar-expand navbar-light d-flex justify-content-between"
          >
            <a href="./" class="navbar-brand"
              ><img class="img-fluid" src="assets/images/logo.png" alt=""
            /></a>
            <button
              class="navbar-toggler"
              type="button"
              data-toggle="collapse"
              data-target="#navbarSupportedContent"
              aria-controls="navbarSupportedContent"
              aria-expanded="false"
              aria-label="Toggle navigation"
            >
              <span class="navbar-toggler-icon"></span>
            </button>
            <div
              class="collapse navbar-collapse pt-3 pb-3"
              id="navbarSupportedContent"
              style="flex-grow: unset"
            >
              <form
                class="form-inline d-none d-lg-inline-block"
                id="site_search"
              >
                <input
                  class="form-control"
                  type="search"
                  placeholder="在找什麼嗎？"
                  aria-label="Search"
                  id="form_search"
                />
                <button class="btn" type="submit" id="form_submit">
                  <i class="fas fa-search"></i>
                </button>
              </form>
              <div
                class="d-flex flex-row bd-highlight align-items-center"
                id="header_func"
              >
                <div class="p-2 pl-lg-4 bd-highlight">
                  <span class="d-md-inline-block d-none">購物車 / </span
                  ><span class="text-warning" id="price_in_cart">$0</span>
                  <a href="cart"
                    ><i class="fas fa-shopping-cart d-md-none"></i
                  ></a>
                </div>
                <div class="p-2 bd-highlight">
                  <a href="favorite"
                    ><i class="fab fa-gratipay d-md-none"></i
                    ><span class="d-md-block d-none">追蹤清單</span></a
                  >
                </div>
                <div class="p-2 bd-highlight">
                  <a href="mc_order"
                    ><i class="fas fa-user-circle d-md-none"></i
                    ><span class="d-md-block d-none">帳戶管理</span></a
                  >
                </div>
              </div>
            </div>
          </nav>
        </div>
      </header>
      <!-- header結束 -->

      <!-- 以下menu開始 -->
      <div id="menu">
        <div class="container" :style="{'max-width': menu_width+'px' }">
          <ul :style="{'width': menu_width+'px' }" class="main_menu">
            <li
              class="d-inline-block"
              v-for="(item, index) in main_list"
              @click="menuHandler('current_main_menu', index, item.category_id)"
              :class="{'active':current_main_menu === index}"
            >
              {{ item.category_name }}
            </li>
          </ul>
        </div>
        <div
          id="sub_menu"
          class="container"
          :class="{'show': current_main_menu!== null}"
          @mouseleave="mouseLeave"
          @focusout="mouseLeave"
          v-if="current_main_menu"
        >
          <div class="for_mb_left">
            <ul
              v-for="(sub_item, idx) in filter_rest_list"
              class="d-inline-block"
            >
              <h4
                :class="{'active': current_extra_menu === idx }"
                @click="menuHandler('current_sub_menu', idx)"
              >
                {{ sub_item.category_sub_name }}
              </h4>
              <li v-for="extra_item in sub_item.extra_list">
                <a href="#">{{ extra_item.category_extra_name}}</a>
              </li>
            </ul>
          </div>
          <div class="d-md-none" v-if="filter_mb_extra_list">
            <ul>
              <li v-for="extra_item in filter_mb_extra_list">
                <a href="#">{{ extra_item.category_extra_name}}</a>
              </li>
            </ul>
          </div>
        </div>
      </div>
      <link rel="stylesheet" href="assets/css/header.css" />
      <script>
        var wrapper = new Vue({
          el: "#menu",
          data: {
            main_list: null,
            sub_list: null,
            extra_list: null,
            current_main_menu: null,
            current_sub_menu: "", // category_id
            current_extra_menu: 0, // category_sub_id
            menu_width: 1258, // default: 個別選單寬度80*17個
          },
          computed: {
            filter_rest_list() {
              if (this.sub_list) {
                const filter_data = this.sub_list.filter((item) => {
                  const inner_list = this.extra_list.filter((extra) => {
                    return extra.category_sub_id === item.category_sub_id;
                  });
                  if (item.category_id === this.current_sub_menu) {
                    // 把對應extra_list塞入sub_list
                    item["extra_list"] = inner_list;
                  }
                  return item.category_id === this.current_sub_menu;
                });
                return filter_data;
              }
            },
            filter_mb_extra_list() {
              const extra_list = this.filter_rest_list[this.current_extra_menu];
              return extra_list ? extra_list.extra_list : [];
            },
          },
          mounted() {
            this.$nextTick(() => {
              this.loadMenu(); // 撈選單資料
              document.addEventListener("click", (e) => {
                const menu = document.getElementById("menu");
                const menu_outside_click = ~e.composedPath().indexOf(menu) >= 0;
                if (menu_outside_click) this.current_main_menu = null;
              });
            });
          },
          methods: {
            loadMenu() {
              const main = axios.get("assets/json/find_main_list.json");
              const sub = axios.get("assets/json/find_sub_list.json");
              const extra = axios.get("assets/json/find_extra_list.json");

              axios
                .all([main, sub, extra])
                .then(
                  axios.spread((...responses) => {
                    const { data: main_list } = responses[0];
                    const { data: sub_list } = responses[1];
                    const { data: extra_list } = responses[2];
                    this.main_list = main_list;
                    this.sub_list = sub_list;
                    this.extra_list = extra_list;
                    this.menu_width = this.main_list.length * 80;
                  })
                )
                .catch((errors) => {
                  console.error(errors);
                  // react on errors.
                });
            },
            menuHandler(menuType, index, id) {
              // 選單切換
              switch (menuType) {
                case "current_main_menu":
                  {
                    this[menuType] = index;
                    this.current_sub_menu = id;
                  }
                  break;
                case "current_sub_menu":
                  {
                    this.current_extra_menu = index;
                  }
                  break;
              }
            },
            mouseLeave() {
              console.log("leave");
              this.current_main_menu = null;
            },
          },
        });
      </script>
      <style>
        #menu {
          position: fixed;
          top: 90px;
        }
      </style>
      <!-- menu結束 -->

      <!-- 以下content始 -->
      <div id="product">
        <div class="container">
          <div class="row">
            <div id="tab_list" class="col-xl-2" v-if="productData">
              <h4>產品分類</h4>
              <ul>
                <li>
                  <h3>生活家電</h3>
                  <ul class="sub_ul">
                    <li>農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                  </ul>
                </li>
                <li class="active">
                  <h3>生活家電</h3>
                  <ul class="sub_ul">
                    <li>農會超市</li>
                    <li class="active">農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                  </ul>
                </li>
                <li>
                  <h3>生活家電</h3>
                  <ul class="sub_ul">
                    <li>農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                    <li>農會超市</li>
                  </ul>
                </li>
              </ul>
            </div>

            <div id="detail" class="col-xl-10" v-if="productData">
              <div class="bread">
                <a href="#">首頁</a>
                <span>></span>
                <a href="#">家事清潔</a>
                <span>></span>
                <a href="#" class="active">衣物清潔</a>
              </div>
              <div class="info"></div>
            </div>
          </div>
        </div>
      </div>
      <script>
        var wrapper = new Vue({
          el: "#product",
          data: {
            productData: null,
          },
          created() {
            this.product();
          },
          mounted() {
            var _this = this;
            _this.loadAndPop();
            // 上下頁照params改動
            window.onpopstate = function () {
              _this.loadAndPop();
            };
          },
          methods: {
            product: function () {
              var _this = this;
              axios({
                method: "get",
                url: "assets/json/product.json",
                responseType: "json",
              }).then(function (data) {
                const { data: product_data, status } = data;
                if (status == 200) {
                  _this.productData = product_data;
                  console.log(_this.productData);
                } else {
                }
              });
            },
            tabHandler: function (tab, index) {
              // console.log(tab, index);
              this[tab] = index;
            },
            loadAndPop: function () {
              var _this = this;
              var _isUrlClear = allFunc.getUrlParam("category_id");
              // _this.slide();
              _this.product();

              function afterMainLoad() {
                // if( _isUrlClear == "" || _isUrlClear == null){
                // 網址不帶params。隨機
                // var _length = _this.category.main.length-1;
                // var _getRandom = allFunc.randomFunc(0,_length);
                // _this.category.active = {
                //     main : _this.category.main[_getRandom].category_id,
                //     sub : null,
                //     extra : null,
                // }
                // window.history.pushState({},0,'category/' + '?category_id=' + _this.category.active.main);
                // }else{
                // _this.category.active = {
                //     main : allFunc.getUrlParam("category_id"),
                //     sub : allFunc.getUrlParam("category_sub_id"),
                //     extra : allFunc.getUrlParam("category_extra_id"),
                // }
                // }
                // 如果sub在：呼叫sub跟extra
                // 如果sub不在：呼叫sub
                // console.log(_this.category.active["sub"])
                // if( _this.category.active["sub"] == undefined || _this.category.active["sub"] == null ){
                //     // 如果sub不在
                //     _this.list_sub(_this.category.active["main"]);
                // }else{
                //     // 如果sub在
                //     _this.list_sub(_this.category.active["main"]);
                //     _this.list_extra(_this.category.active["sub"]);
                // }
                // 呼叫商品列表
                // _this.product_list()
              }
            },
          },
        });
      </script>
      <!-- content結束 -->

      <!-- footer php include -->
      <div id="footer">
        <div class="container mt-5 pt-4 clearfix">
          <div class="index-for5 mb-4">
            <h2 class="mb-3">關於我們</h2>
            <ul>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >7YAGO福利網</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >招募供應商</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >機構團體加入</a
                >
              </li>
            </ul>
          </div>
          <div class="index-for5 mb-4">
            <h2 class="mb-3">專屬服務</h2>
            <ul>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >大宗採購方案</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >年節禮品採購</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >異業合作</a
                >
              </li>
            </ul>
          </div>
          <div class="index-for5 mb-4">
            <h2 class="mb-3">會員權益</h2>
            <ul>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >隱私權政策</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >電子商務條款</a
                >
              </li>
            </ul>
          </div>
          <div class="index-for5 mb-4">
            <h2 class="mb-3">常見問題</h2>
            <ul>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >訂單出貨流程說明</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >取消訂單/退貨/退款說明</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >購物金使用說明</a
                >
              </li>
              <li>
                <a href="http://" target="_blank" rel="noopener noreferrer"
                  >聯絡我們</a
                >
              </li>
            </ul>
          </div>
          <div class="index-for5 mb-4">
            <h2 class="mb-3">隨身好助理</h2>
            <img src="assets/images/qrcode.png" alt="" class="img-fluid w-75" />
          </div>
        </div>
        <div class="text-center pb-3">
          <p class="m-0">
            <small>吉品養生股份有限公司 2020 ALL Rights Reserved</small>
          </p>
          <p>
            <small class="m-0"
              >台北市忠孝東路四段212號10樓。客服信箱：service@yonglinfarm.net</small
            >
          </p>
        </div>
      </div>
    </div>
  </body>
</html>
